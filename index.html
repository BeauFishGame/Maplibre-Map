<!DOCTYPE html><meta charset="utf-8"><title>Auckland Waikato Fishing Map</title><link rel="icon" href="src/images/favicon.png" type="image/png"><meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no"><script src="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.js"></script><link href="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.css" rel="stylesheet"><style>body{margin:0;padding:0}#map{position:absolute;top:0;bottom:0;width:100%}.map-overlay{display:none;font:12px/20px Arial,sans-serif;padding:10px;position:absolute;right:0;top:0;width:230px;overflow:hidden;white-space:normal;transition:opacity .3s ease}.map-overlay-inner{position:fixed;top:80px;left:10px;width:400px;height:calc(100vh - 90px);padding:15px;background:#fff;border-radius:8px;box-shadow:0 4px 10px rgba(0,0,0,.5);z-index:999;box-sizing:border-box;display:flex;flex-direction:column}.panel-scroll{padding-top:30px;flex:1;overflow-y:auto;min-height:0;-webkit-overflow-scrolling:touch}.map-overlay-inner hr{margin:5px 0;border:none;border-top:2px solid #ccc}#zoom-level{position:absolute;bottom:10px;left:1000px;background:rgba(255,255,255,.8);padding:6px 10px;font-family:Arial,sans-serif;font-size:14px;border-radius:4px;z-index:1;user-select:none;pointer-events:none}.card-title{font-family:Arial,sans-serif;font-size:25px;font-weight:700;color:#2a2a2a}.card-list{list-style-type:none;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;font-size:15px;padding-left:0;margin:0}.subtitle-main{font-size:1.3em;font-weight:700;color:#333;margin-top:4px}.directions-inline-image{width:20px;height:20px;cursor:pointer;opacity:.85;transition:transform .2s,opacity .2s}.directions-inline-image:hover{transform:scale(1.1);opacity:1}.subtitle-region{font-size:1.em;font-style:italic;color:#666;margin-bottom:4px}#filter-toggle-btn:hover{background-color:#f0f0f0}#actions button:active{transform:translateY(1px)}.close-button{position:absolute;top:10px;right:15px;background:0 0;border:none;font-size:24px;color:#333;cursor:pointer;z-index:10000}#top-bar{position:relative;height:70px;background-color:#070707;display:flex;align-items:center;padding:0 20px;z-index:10}#top-bar .logo{height:70px;z-index:11}#search-container input[type=text]{width:100%;padding:10px 14px;font-size:14px;border:none;border-radius:20px;background-color:rgba(255,255,255,.2);color:#e7e2e2;outline:0;transition:background-color .3s ease,box-shadow .3s ease}#search-container input[type=text]:focus{background-color:rgba(255,255,255,.3);box-shadow:0 0 0 2px rgba(255,255,255,.3)}#suggestions{position:absolute;top:100%;left:0;width:100%;background-color:rgba(255,255,255,.95);border-radius:0 0 20px 20px;overflow:hidden;max-height:300px;overflow-y:auto;display:none;z-index:11;box-shadow:0 4px 6px rgba(0,0,0,.2);border:none;font-family:Arial,sans-serif}.suggestion{padding:8px 10px;font-weight:200;cursor:pointer;border-bottom:1px solid #f0f0f0}.suggestion:hover{background:#f0f0f0}.suggestion-header{font-weight:700;font-size:.85rem;padding:8px 10px;background-color:#f9f9f9;color:#444;text-transform:uppercase;letter-spacing:.5px;border-top:1px solid #ddd;border-bottom:1px solid #ddd}.river-header{border-left:4px solid #0072b2}.point-header{border-left:4px solid #d55e00}.section{font-size:80%}.region{font-style:italic;font-size:75%;color:#888}.maplibregl-ctrl-top-right{top:70px}.modal{display:none;position:fixed;z-index:9999;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,.85)}.modal.show{display:flex;justify-content:center;align-items:center}.modal-content{max-width:80%;max-height:80%;border-radius:6px;box-shadow:0 0 20px rgba(0,0,0,.5)}.close-modal{position:absolute;top:30px;right:50px;color:#fff;font-size:40px;font-weight:700;cursor:pointer}.basemap-btn{display:block;width:100%;margin-bottom:8px;padding:10px;border:none;border-radius:6px;font-size:14px;text-align:left;background-color:#e9edf3;cursor:pointer;transition:background-color .2s ease}.basemap-btn:hover{background-color:#d1d5db}.basemap-btn.active{background-color:#10b981;color:#fff;font-weight:700}#actions button{height:70%;aspect-ratio:1/1;border-radius:20%;padding:0;display:flex;align-items:center;justify-content:center;background:#fff;border:none;box-shadow:0 1px 2px rgba(0,0,0,.1);cursor:pointer}#search-container{position:absolute;left:50%;transform:translateX(-50%);width:20vw;min-width:200px;z-index:11}@media (max-width:768px){#search-container{position:static;left:auto;transform:none;flex:1 1 auto;min-width:0;max-width:none;margin-right:30px}}@media (max-width:768px){#top-bar{height:56px;padding:0 10px}#top-bar .logo{display:none}#search-container{flex:1 1 auto}#actions button{width:44px;height:44px;border-radius:10px}#actions button img{width:22px;height:22px}#suggestions{max-height:45vh}.maplibregl-ctrl-top-right{top:8px}}@media (max-width:768px){.maplibregl-ctrl-top-right{top:auto!important;right:auto!important;bottom:10px;left:10px;flex-direction:column}}@media (max-width:768px){.map-overlay-inner{position:fixed;top:auto;bottom:0;left:0;width:100vw;height:60vh;border-radius:14px 14px 0 0;padding-bottom:calc(16px + env(safe-area-inset-bottom))}.panel-scroll{padding-top:36px}.close-button{top:8px;right:12px;font-size:28px}}@media (max-width:768px){#basemap-toggle-btn,#filter-toggle-btn{padding:12px;border-radius:10px}#basemap-toggle-btn img,#filter-toggle-btn img{width:24px;height:24px}}@media (max-width:768px){.maplibregl-ctrl-bottom-right{margin:0 10px calc(10px + env(safe-area-inset-bottom)) 0}}@media (max-width:768px){.map-overlay-inner{box-shadow:0 6px 16px rgba(0,0,0,.25)}.source-card{border-radius:8px}.basemap-btn{padding:12px}}#actions{margin-left:auto;display:flex;align-items:center;gap:8px}#actions #basemap-toggle-btn,#actions #filter-toggle-btn{position:static;right:auto;top:auto;display:grid;place-items:center;width:40px;height:40px;padding:0;background:#fff;border:none;border-radius:8px;box-shadow:0 1px 2px rgba(0,0,0,.1);cursor:pointer}#actions #basemap-toggle-btn img,#actions #filter-toggle-btn img{width:20px;height:20px;display:block}@media (max-width:768px){#actions #basemap-toggle-btn,#actions #filter-toggle-btn{width:44px;height:44px;border-radius:10px}#actions #basemap-toggle-btn img,#actions #filter-toggle-btn img{width:22px;height:22px}}@media (max-width:768px){#top-bar{display:flex;align-items:center;gap:8px}#search-container input[type=text]{width:100%;font-size:16px}#actions #basemap-toggle-btn,#actions #filter-toggle-btn{position:static}}</style><div id="imageModal" class="modal"><span class="close-modal" onclick="closeModal()">&times;</span> <img class="modal-content" id="modalImage"></div><div id="map"></div><div id="top-bar"><a href="https://www.fishandgame.org.nz/" target="_blank"><img class="logo" src="src/images/White%20LS.png" alt="Logo"></a><div id="search-container"><input type="text" id="search" placeholder="Search water and points..." autocomplete="off"><div id="suggestions"></div></div><div id="actions"><button onclick="toggleBasemaps()" id="basemap-toggle-btn" aria-label="Basemaps"><img src="src/images/Layers.svg" alt=""></button> <button onclick="toggleFilters()" id="filter-toggle-btn" aria-label="Filters"><img src="src/images/Filters.svg" alt=""></button></div></div><div id="combined-filters" style="display:none"><div class="map-overlay-inner"><button class="close-button" onclick="openPanel(null)">&times;</button><div class="panel-scroll"><style>#combined-filters,#combined-filters *{font-family:Arial,sans-serif}.filters-body{padding:6px 0 0}.source-card{background:#f6f7f9;border:1px solid #e2e5ea;border-radius:10px;margin-bottom:10px;overflow:hidden}.source-head{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:10px 12px;background:#e9edf3;cursor:pointer}.source-name{font-weight:700;font-size:13px;color:#1f2937}.source-controls{display:flex;align-items:center;gap:8px}.btn{appearance:none;border:0;border-radius:8px;background:#374151;color:#fff;padding:6px 10px;cursor:pointer;font-size:12px}.btn[aria-pressed=true]{background:#10b981}.btn.small{padding:4px 8px;font-size:11px}.source-body{display:none;padding:10px 12px;background:#fff;border-top:1px solid #e2e5ea}.group{margin-bottom:12px}.group-title{font-size:12px;font-weight:700;margin-bottom:6px;color:#374151}.option{display:flex;align-items:center;gap:8px;margin:4px 0;font-size:12px}.option input{cursor:pointer}.hint{font-size:11px;opacity:.8}</style><div id="filters-body" class="filters-body"><div class="source-card" data-source="waterways"><div class="source-head"><div class="source-name">Waterway Layers</div><div class="source-controls"><button class="btn toggle-visible" aria-pressed="true" data-source="waterways">Shown</button> <button class="btn small toggle-expand" aria-expanded="false">Options ▾</button></div></div><div class="source-body"><div class="group" data-group="w-method" data-type="radioOne"><div class="group-title">Allowed Method</div><label class="option"><input type="radio" name="w-method" value="__ALL__" checked="checked"> ALL</label> <label class="option"><input type="radio" name="w-method" value="fly"> Fly</label> <label class="option"><input type="radio" name="w-method" value="spin"> Spin</label> <label class="option"><input type="radio" name="w-method" value="bait"> Bait</label> <label class="option"><input type="radio" name="w-method" value="fly_only"> Fly only</label></div><div class="group" data-group="w-type" data-type="radioOne"><div class="group-title">Waterway type</div><label class="option"><input type="radio" name="w-type" value="__ALL__" checked="checked"> ALL</label> <label class="option"><input type="radio" name="w-type" value="river"> Rivers/streams</label> <label class="option"><input type="radio" name="w-type" value="lake"> Lakes</label> <label class="option"><input type="radio" name="w-type" value="canal"> Canals</label> <label class="option"><input type="radio" name="w-type" value="pond"> Ponds</label></div><div class="group" data-group="w-open" data-type="radioOne"><div class="group-title">Open</div><label class="option"><input type="radio" name="w-open" value="style_today" checked="checked"> Color code by open/closed based on todays date</label> <label class="option"><input type="radio" name="w-open" value="filter_today"> Show only waterways open today</label></div><div class="group" data-group="w-fishery" data-type="checkboxAny"><div class="group-title">Fishery type</div><label class="option"><input type="checkbox" data-role="all" checked="checked"> All</label> <label class="option"><input type="checkbox" value="back_country" checked="checked"> Back country</label> <label class="option"><input type="checkbox" value="sea_run_salmon" checked="checked"> Sea-run salmon fishery</label> <label class="option"><input type="checkbox" value="designated" checked="checked"> Designated water</label> <label class="option"><input type="checkbox" value="controlled" checked="checked"> Controlled fishery</label> <label class="option"><input type="checkbox" value="junior" checked="checked"> Junior fishery</label> <label class="option"><input type="checkbox" value="stocked" checked="checked"> Stocked fishery</label> <label class="option"><input type="checkbox" value="coarse" checked="checked"> Coarse fishery</label></div><div class="group" data-group="w-species" data-type="checkboxAny"><div class="group-title">Known Species</div><label class="option"><input type="checkbox" data-role="all" checked="checked"> All</label> <label class="option"><input type="checkbox" value="rainbow_trout" checked="checked"> Rainbow Trout</label> <label class="option"><input type="checkbox" value="brown_trout" checked="checked"> Brown Trout</label> <label class="option"><input type="checkbox" value="perch" checked="checked"> Perch</label> <label class="option"><input type="checkbox" value="tench" checked="checked"> Tench</label> <label class="option"><input type="checkbox" value="rudd" checked="checked"> Rudd</label> <label class="option"><input type="checkbox" value="brook_trout" checked="checked"> Brook Trout</label> <label class="option"><input type="checkbox" value="sockeye_salmon" checked="checked"> Sockeye salmon</label> <label class="option"><input type="checkbox" value="chinook_salmon" checked="checked"> Chinook salmon</label></div></div></div><div class="source-card" data-source="points"><div class="source-head"><div class="source-name">Point Layers</div><div class="source-controls"><button class="btn toggle-visible" aria-pressed="true" data-source="points">Shown</button> <button class="btn small toggle-expand" aria-expanded="false">Options ▾</button></div></div><div class="source-body"><div class="group" data-group="p-type" data-type="checkboxAny"><div class="group-title">Point Type</div><label class="option"><input type="checkbox" data-role="all" checked="checked"> Select all</label> <label class="option"><input type="checkbox" value="AccessPoint" checked="checked"> F&amp;G Access</label> <label class="option"><input type="checkbox" value="WalkingFGAccess" checked="checked"> F&amp;G Tramping Access</label> <label class="option"><input type="checkbox" value="4x4Access" checked="checked"> F&amp;G 4x4 Access</label> <label class="option"><input type="checkbox" value="BoatRamp" checked="checked"> Boat ramp</label> <label class="option"><input type="checkbox" value="FlyFishing" checked="checked"> Fishing spot - Fly</label> <label class="option"><input type="checkbox" value="Jigging" checked="checked"> Fishing spot - Jigging</label> <label class="option"><input type="checkbox" value="Trolling" checked="checked"> Fishing spot - Trolling</label> <label class="option"><input type="checkbox" value="Store" checked="checked"> Fly fishing stores</label> <label class="option"><input type="checkbox" value="Lodge" checked="checked"> Fly fishing lodgees</label> <label class="option"><input type="checkbox" value="Hut" checked="checked"> DOC Huts</label> <label class="option"><input type="checkbox" value="Campsite" checked="checked"> DOC Campgrounds</label> <label class="option"><input type="checkbox" value="FlowStation" checked="checked"> River flow monitoring stations</label></div></div></div><div class="source-card" data-source="publicAccess"><div class="source-head"><div class="source-name">Public Access &amp; Property Layers</div><div class="source-controls"><button class="btn toggle-visible" aria-pressed="true" data-source="publicAccess">Shown</button> <button class="btn small toggle-expand" aria-expanded="false">Options ▾</button></div></div><div class="source-body"><div class="hint"><a href="https://www.herengaanuku.govt.nz/types-of-access" target="_blank">Learn more about legal public access in NZ</a></div></div></div><div class="source-card" data-source="regions"><div class="source-head"><div class="source-name">Fish &amp; Game Regions</div><div class="source-controls"><button class="btn toggle-visible" aria-pressed="true" data-source="regions">Shown</button> <button class="btn small toggle-expand" aria-expanded="false">Options ▾</button></div></div><div class="source-body"><div class="hint">Show/Hide toggles outlines + labels together.</div></div></div></div><script>document.querySelectorAll("#filters-body .toggle-expand").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.closest(".source-card").querySelector(".source-body"),r="block"===t.style.display;t.style.display=r?"none":"block",e.target.setAttribute("aria-expanded",String(!r)),e.target.textContent=r?"Options ▾":"Options ▴"})}),document.querySelectorAll('#filters-body .group[data-type="checkboxAny"]').forEach(e=>{const t=e.querySelector('input[data-role="all"]'),r=Array.from(e.querySelectorAll('input[type="checkbox"]:not([data-role="all"])'));t&&(t.addEventListener("change",()=>r.forEach(e=>e.checked=t.checked)),r.forEach(e=>{e.addEventListener("change",()=>{e.checked||(t.checked=!1),r.every(e=>e.checked)&&(t.checked=!0)})}))});let filterTimer=null;function scheduleApply(e){let t;filterTimer&&cancelAnimationFrame(filterTimer),filterTimer=requestAnimationFrame(()=>{clearTimeout(t),t=setTimeout(()=>e(),120)})}window.setupAWFilters=function(e){if(window.__filtersWired)return;window.__filtersWired=!0;const t={waterways:["AW Rivers-line","AW Rivers-fill"],points:["data-points-all"],publicAccess:["PublicAccessAreas-fill"],regions:["FG Regions-line","nz-region-labels"]},r={fly:"fly",spin:"spin",bait:"bait",closed:"permanently_closed",open_start:"open_date_unix",open_end:"close_date_unix",type:null,fishery:null,species:null},l={type:"point_type"},n=document.getElementById("filters-body"),i=e=>{const t=n.querySelector(`.group[data-group="${e}"] input[type="radio"]:checked`);return t?t.value:null},o=e=>{const t=n.querySelector(`.group[data-group="${e}"] input[data-role="all"]`),r=[...n.querySelectorAll(`.group[data-group="${e}"] input[type="checkbox"]:not([data-role="all"])`)];if(t&&t.checked)return null;const l=r.filter(e=>e.checked).map(e=>e.value);return l.length?l:[]};document.querySelectorAll("#filters-body .toggle-visible").forEach(r=>{r.addEventListener("click",r=>{const l="true"===r.target.getAttribute("aria-pressed"),n=r.target.dataset.source;var i;r.target.setAttribute("aria-pressed",String(!l)),r.target.textContent=l?"Hidden":"Shown",i=!l,(t[n]||[]).forEach(t=>{e.getLayer(t)&&e.setLayoutProperty(t,"visibility",i?"visible":"none")})})});const s=Object.create(null);function a(t,r){const l=JSON.stringify(r);s[t]!==l&&(s[t]=l,e.getLayer(t)&&e.setFilter(t,r))}function c(){const e=i("w-method"),l=i("w-open"),n=i("w-type"),s=o("w-fishery"),c=o("w-species"),u=r,d=[];if(e&&"__ALL__"!==e&&("fly_only"===e?d.push(["all",["==",["get",u.fly],1],["==",["get",u.spin],0],["==",["get",u.bait],0],["==",["get",u.closed],0]]):["fly","spin","bait"].includes(e)&&d.push(["==",["get",u[e]],1])),n&&"__ALL__"!==n&&u.type&&d.push(["==",["get",u.type],n]),s&&s.length&&u.fishery&&d.push(["in",["get",u.fishery],["literal",s]]),c&&c.length&&u.species&&d.push(["in",["get",u.species],["literal",c]]),"filter_today"===l){const e=window.__TODAY_UNIX__;d.push(["all",["<=",["get",u.open_start],e],[">=",["get",u.open_end],e]])}const p=!d.length||["all",...d];(t.waterways||[]).forEach(e=>a(e,p))}function u(){const e=o("p-type");let r=!0;r=null===e||(0===e.length?["==",["get","point_type"],"__NONE__"]:["in",["get",l.type],["literal",e]]),(t.points||[]).forEach(e=>a(e,r))}n.addEventListener("change",e=>{const t=e.target.closest(".source-card");if(!t)return;const r=t.dataset.source;scheduleApply(()=>{"waterways"===r&&c(),"points"===r&&u()})}),e.on("idle",function(){e.getLayer("AW Rivers-line")&&e.getLayer("data-points-all")&&(c(),u())})}</script></div></div><div id="zoom-level"></div></div><div id="combined-basemaps" style="display:none"><div class="map-overlay-inner"><button class="close-button" onclick="openPanel(null)">&times;</button><div class="panel-scroll"><div class="basemap-body"><div class="source-card"><div class="source-head"><div class="source-name">Basemaps</div></div><div class="source-controls"><button class="basemap-btn" data-basemap="Satellite">LINZ Satellite</button> <button class="basemap-btn" data-basemap="TopoLite">LINZ Topo Lite</button> <button class="basemap-btn" data-basemap="Topo">LINZ Topo50</button></div></div></div></div></div></div><div class="map-overlay" id="properties"></div><script>const styleURL="https://basemaps.linz.govt.nz/v1/styles/topo-raster.json?api=d01hep5551e30kxb7w85hck49tp",TODAY_UNIX=1786611515,map=new maplibregl.Map({container:"map",style:styleURL,center:[175.6,-38.1],minZoom:5,zoom:5});function openImageModal(e){const t=document.getElementById("imageModal");document.getElementById("modalImage").src=e,t.classList.add("show"),t.onclick=function(e){e.target===t&&closeModal()}}function closeModal(){const e=document.getElementById("imageModal");e.classList.remove("show"),e.onclick=null}map.addControl(new maplibregl.NavigationControl({showCompass:!1})),map.addControl(new maplibregl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0})),map.dragRotate.disable(),map.touchZoomRotate.disableRotation();let activePanel=null;function openPanel(e){const t=document.getElementById("properties"),o=document.getElementById("combined-filters"),a=document.getElementById("combined-basemaps");t.style.display="none",o.style.display="none",a.style.display="none",activePanel=null,"card"===e?(t.style.display="block",activePanel="card"):"filters"===e?(o.style.display="block",activePanel="filters"):"basemaps"===e&&(a.style.display="block",activePanel="basemaps")}function toggleFilters(e){openPanel("filters"===activePanel?null:"filters")}function toggleBasemaps(e){openPanel("basemaps"===activePanel?null:"basemaps")}document.addEventListener("click",function(e){const t=document.getElementById("combined-filters"),o=document.getElementById("filter-toggle-btn");"block"===t.style.display&&(t.contains(e.target)||o.contains(e.target)||openPanel(null))});const card=document.getElementById("properties"),pointTypeDefaultImages={AccessPoint:"images/Slide1.png",TrampingAccess:"images/Slide2.png","4x4Access":"images/Slide3.png",BoatRamp:"images/Slide4.png",Trolling:"images/Slide5.png",Toilet:"images/Slide6.png",Jigging:"images/Slide7.png",FlyFishing:"images/Slide8.png",Warning:"images/Slide9.png","DOC Hut":"images/Slide10.png","DOC Campground":"images/Slide11.png"},showCard=e=>{const t=e.properties,o={methods:"Method",open_season:"Open",limit_trout:"Trout Limit",Description:"Description",additional_requirements:"Additional Requirements"},a=t.point_type&&"na"!==t.point_type.toLowerCase()?pointTypeDefaultImages[t.point_type]:null,n=[t.Image1,t.Image2,t.Image3].filter(e=>e&&""!==e.trim()),i=(a?[a]:[]).concat(n);let s='\n<div class="map-overlay-inner">\n  <div class="map-overlay-drag-handle"></div>\n  <button class="close-button" onclick="openPanel(null)">&times;</button>\n  <div class="panel-scroll">\n';if(i.length>0&&(s+=`\n  <div class="card-image-container" style="margin-bottom: 10px;">\n    <img id="cardMainImage" src="${i[0]}" \n      alt="Location Photo"\n      onclick="openImageModal('${i[0]}')"\n      style="width: 100%; height: 160px; object-fit: cover; object-position: center; border-radius: 6px; cursor: pointer;">\n    ${i.length>1?'\n    <div class="carousel-controls" style="display: flex; justify-content: space-between; margin-top: 4px;">\n      <button onclick="prevImage()" class="carousel-button">❮</button>\n      <button onclick="nextImage()" class="carousel-button">❯</button>\n    </div>':""}\n  </div>\n`),s+=`\n  <code class="card-title">${t.Water||t.name||t.Title||"No Title"}</code>\n`,t.subtitle||"string"==typeof t.Section&&""!==t.Section.trim()){if(s+=`<div class="card-subtitle subtitle-main">${t.subtitle||t.Section}`,"Point"===e.geometry?.type&&Array.isArray(e.geometry.coordinates)){const[t,o]=e.geometry.coordinates;s+=`\n            <a href="${`https://www.google.com/maps/dir/?api=1&destination=${o},${t}`}" target="_blank" title="Get Directions">\n              <img src="images/directions.png" alt="Get Directions" class="directions-inline-image">\n            </a>\n          `}s+="</div>"}t.Region&&(s+=`<div class="card-subtitle subtitle-region">${t.Region} Fish & Game Region</div>`),s+='<hr><ul class="card-list">';for(const[e,a]of Object.entries(o))void 0!==t[e]&&""!==t[e]&&(s+=`<li><b>${a}</b>: ${t[e]}</li>`);t.URL1&&""!==t.URL1.trim()&&(s+=`<li><b>More Information</b>: <a href="${t.URL1}" target="_blank" rel="noopener noreferrer">Click here</a></li>`),s+="</ul></div></div>",card.innerHTML=s,openPanel("card"),i.length>1&&(window.currentPhotoIndex=0,window.cardPhotoList=i,window.updateCardImage=function(){const e=document.getElementById("cardMainImage"),t=window.cardPhotoList[window.currentPhotoIndex];e.src=t,e.onclick=()=>openImageModal(t)},window.prevImage=function(){window.currentPhotoIndex=(window.currentPhotoIndex-1+window.cardPhotoList.length)%window.cardPhotoList.length,window.updateCardImage()},window.nextImage=function(){window.currentPhotoIndex=(window.currentPhotoIndex+1)%window.cardPhotoList.length,window.updateCardImage()})};let selectedPoint=null,selectedRiver=null;const customImages=[{name:"AccessPoint-icon",url:"images/FGAccess.png"},{name:"hut-icon",url:"images/DOC Hut.png"},{name:"FlyFishing-icon",url:"images/Flyfishing.png"},{name:"Trolling-icon",url:"images/Trolling.png"},{name:"BoatRamp-icon",url:"images/BoatRamp.png"},{name:"Jigging-icon",url:"images/Jigging.png"},{name:"Hut-icon",url:"images/DOC Hut.png"},{name:"Campsite-icon",url:"images/DOC Camp.png"},{name:"4x4Access-icon",url:"images/4x4Access.png"},{name:"WalkingFGAccess-icon",url:"images/WalkingAccess.png"}];function loadCustomImages(e,t){let o=0;customImages.forEach(({name:a,url:n})=>{e.loadImage(n,(i,s)=>{i?console.error(`Error loading image "${a}" from ${n}:`,i):(e.hasImage(a)||e.addImage(a,s),o++,o===customImages.length&&"function"==typeof t&&t())})})}let selectedFeatureId=null,hoverFeatureId=null;function getIconSizeExpr(e,t){return["interpolate",["linear"],["zoom"],7,.01,12,["case",["all",["==",["id"],t??-1],["!=",["id"],e??-2]],.25,["==",["id"],e??-2],.3,.2]]}function updateIconSize(){map.getLayer("data-points-all")&&map.setLayoutProperty("data-points-all","icon-size",getIconSizeExpr(selectedFeatureId,hoverFeatureId))}const isTouch="ontouchstart"in window||navigator.maxTouchPoints>0;function setBasemap(e){if("Satellite"===e)map.setStyle("https://basemaps.linz.govt.nz/v1/styles/aerial.json?api=d01hep5551e30kxb7w85hck49tp");else if("TopoLite"===e)map.setStyle("https://basemaps.linz.govt.nz/v1/styles/topolite.json?api=d01hep5551e30kxb7w85hck49tp");else if("Topo"===e){const e={version:8,sources:{"Topo-tiles":{type:"raster",tiles:["https://basemaps.linz.govt.nz/v1/tiles/topo-raster/WebMercatorQuad/{z}/{x}/{y}.webp?api=c01jz4p0kp7pzdm5cgxrakw47mt"],tileSize:256,attribution:'© <a href="//www.linz.govt.nz/linz-copyright">LINZ CC BY 4.0</a>'}},layers:[{id:"Topo-tiles-layer",type:"raster",source:"Topo-tiles"}]};map.setStyle(e)}document.querySelectorAll(".basemap-btn").forEach(t=>{t.classList.remove("active"),t.dataset.basemap===e&&t.classList.add("active")})}function updateLayerFilter(){const e=document.getElementById("point-type-filter");if(!e)return;const t=e.querySelectorAll('input[type="checkbox"]'),o=["in",["get","point_type"],["literal",Array.from(t).filter(e=>e.checked).map(e=>e.value)]];map.getLayer("data-points-all")&&map.setFilter("data-points-all",o)}isTouch&&(hoverFeatureId=null,map.getLayer("data-points-all")&&updateIconSize()),map.on("styledata",()=>{loadCustomImages(map,()=>{addCustomDataAndLayers()})}),document.querySelectorAll(".basemap-btn").forEach(e=>{e.addEventListener("click",()=>setBasemap(e.dataset.basemap))}),window.addEventListener("load",()=>{setBasemap("Topo")});const clearSelection=()=>{selectedRiver&&(map.setFeatureState({source:"AW Rivers",sourceLayer:"waterways",id:selectedRiver.id},{selected:!1}),selectedRiver=null);const e=document.getElementById("search"),t=document.getElementById("suggestions");e.value="",t.innerHTML="",t.style.display="none",card.innerHTML="",card.style.display="none"},selectFeature=e=>{clearSelection(),"data-points-all"===e.layer.id?(selectedPoint=e,map.setFeatureState({source:"data-points",id:e.id},{selected:!0})):"AW Rivers-line"!==e.layer.id&&"AW Rivers-fill"!==e.layer.id||(selectedRiver=e,map.setFeatureState({source:"AW Rivers",sourceLayer:"waterways",id:e.id},{selected:!0})),showCard(e)};let allFeatures=[],allPointsFeatures=[];fetch("search_index.geojson").then(e=>e.json()).then(e=>{allFeatures=e.features}),fetch("http://170.64.164.127:8080/secure-geojson?token=fish-access-2025").then(e=>e.json()).then(e=>{allPointsFeatures=e.features}).catch(e=>console.error("Failed to load points data:",e));const zoomLevel=document.getElementById("zoom-level");zoomLevel.textContent=`Zoom: ${map.getZoom().toFixed(2)}`,map.on("zoom",()=>{zoomLevel.textContent=`Zoom: ${map.getZoom().toFixed(2)}`});const legacyCheckboxes=document.querySelectorAll('#point-type-filter input[type="checkbox"]');function addCustomDataAndLayers(){const e=map.getStyle().sources;let t=null,o=null;for(const e of map.getStyle().layers)if(t||"symbol"!==e.type||(t=e.id),"Housenumber"===e.id){o="Poi-SportsField";break}o||(o=t),e.PublicAccessAreas||map.addSource("PublicAccessAreas",{type:"vector",url:"http://170.64.164.127:3000/combined_public_access_layers"}),map.getLayer("PublicAccessAreas-fill")||map.addLayer({id:"PublicAccessAreas-fill",type:"fill",source:"PublicAccessAreas","source-layer":"mylayer",minzoom:14,paint:{"fill-color":["match",["get","DataType"],"DOC Conservation Area","#2d6c3e","Esplanade Reserve","#66f0cb","Esplanade Strip","#ff66dc","Hydro Parcel","#abecff","Non-Primary Parcel","#ffcc66","Public Access Easement","#ffd8f1","Reserve Land","#a9cb66","Road Parcel","#cca3e1","Walkway Easement","#ffb2b2","#cccccc"],"fill-opacity":["match",["get","DataType"],"Non-Primary Parcel",.1,.5],"fill-outline-color":"white"}},o),e["AW Rivers"]||map.addSource("AW Rivers",{type:"vector",tiles:["http://170.64.164.127:3000/all_waters/{z}/{x}/{y}"],minzoom:0,maxzoom:13}),map.getLayer("AW Rivers-line")||map.addLayer({id:"AW Rivers-line",type:"line",minzoom:7,source:"AW Rivers","source-layer":"waterways",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":["case",["any",["<",1786611515,["get","open_date_unix"]],[">",1786611515,["get","close_date_unix"]]],["case",["boolean",["feature-state","selected"],!1],"#ac261f",["boolean",["feature-state","highlight"],!1],"#f42f58","#f42f58"],["case",["boolean",["feature-state","selected"],!1],"#3949ab",["boolean",["feature-state","highlight"],!1],"#4ca6e6","#4ca6e6"]],"line-width":["case",["boolean",["feature-state","selected"],!1],7,["boolean",["feature-state","highlight"],!1],5,3],"line-opacity":1}},o),map.getLayer("AW Rivers-fill")||map.addLayer({id:"AW Rivers-fill",type:"fill",minzoom:7,source:"AW Rivers","source-layer":"waterways",paint:{"fill-color":["case",["any",["<",1786611515,["get","open_date_unix"]],[">",1786611515,["get","close_date_unix"]]],["case",["boolean",["feature-state","selected"],!1],"#f42f58 ",["boolean",["feature-state","highlight"],!1],"#f42f58 ","#ec7983"],["case",["boolean",["feature-state","selected"],!1],"#4ca6e6",["boolean",["feature-state","highlight"],!1],"#4ca6e6","#79bcec"]],"fill-opacity":["interpolate",["linear"],["zoom"],14,1,14.01,.2]}},o);const a={type:"FeatureCollection",features:[{type:"Feature",properties:{name:"Northland"},geometry:{type:"Point",coordinates:[174.3237,-35.7251]}},{type:"Feature",properties:{name:"Wellington"},geometry:{type:"Point",coordinates:[174.7772,-41.2889]}},{type:"Feature",properties:{name:"Canterbury"},geometry:{type:"Point",coordinates:[172.6362,-43.5321]}}]};e["nz-regions"]||map.addSource("nz-regions",{type:"geojson",data:a}),map.getLayer("nz-region-labels")||map.addLayer({id:"nz-region-labels",type:"symbol",source:"nz-regions",minzoom:5,maxzoom:7,layout:{"text-field":["get","name"],"text-size":64,"text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-offset":[0,.7],"text-anchor":"top"},paint:{"text-color":"#004d00","text-halo-color":"#ffffff","text-halo-width":1.2}}),e["FG Regions"]||map.addSource("FG Regions",{type:"geojson",data:"FG_dissolved.geojson"}),map.getLayer("FG Regions-line")||map.addLayer({id:"FG Regions-line",type:"line",source:"FG Regions",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#4A6741","line-width":2,"line-opacity":1}},o),e.Routes||map.addSource("Routes",{type:"geojson",data:"Routes.geojson"}),map.getLayer("Routes-line")||map.addLayer({id:"Routes-line",type:"line",source:"Routes",minzoom:11.09,paint:{"line-width":["get","line_width"],"line-color":["get","line_color"],"line-dasharray":[2,1]}}),e["data-points"]||map.addSource("data-points",{type:"geojson",data:"AccessPoints.geojson",generateId:!0}),map.getLayer("data-points-all")||map.addLayer({id:"data-points-all",type:"symbol",source:"data-points",minzoom:7,layout:{"icon-image":["concat",["get","point_type"],"-icon"],"icon-size":getIconSizeExpr(selectedFeatureId,hoverFeatureId),"icon-anchor":"bottom","icon-allow-overlap":!0}}),e.search||map.addSource("search",{type:"geojson",data:"search_index.geojson"}),map.getLayer("search-points-all")||map.addLayer({id:"search-points-all",type:"circle",source:"search",paint:{"circle-radius":5,"circle-color":"#FF5733","circle-opacity":0}}),window.setupAWFilters&&window.setupAWFilters(map)}legacyCheckboxes.forEach(e=>e.addEventListener("change",updateLayerFilter));const popup=document.createElement("div");popup.style.position="absolute",popup.style.pointerEvents="none",popup.style.backgroundColor="rgba(0, 0, 0, 0.6)",popup.style.color="#fff",popup.style.fontFamily="Arial, sans-serif",popup.style.padding="4px 8px",popup.style.borderRadius="4px",popup.style.fontSize="12px",popup.style.display="none",document.body.appendChild(popup),map.on("mousemove","PublicAccessAreas-fill",e=>{const t=e.features?.[0];t&&(popup.style.display="block",popup.textContent=t.properties.DataType||"No DataType",popup.style.left=e.originalEvent.pageX+10+"px",popup.style.top=e.originalEvent.pageY+10+"px")}),map.on("mouseleave","PublicAccessAreas-fill",()=>{popup.style.display="none"}),map.on("click","data-points-all",e=>{selectedFeatureId=e.features[0].id,hoverFeatureId=null,updateIconSize()}),map.on("click",e=>{const t=map.queryRenderedFeatures(e.point,{layers:["data-points-all","AW Rivers-line","AW Rivers-fill"]});if(0===t.length)return clearSelection(),void(card.style.display="none");const o=t.find(e=>"data-points-all"===e.layer.id),a=t.find(e=>"AW Rivers-line"===e.layer.id)||t.find(e=>"AW Rivers-fill"===e.layer.id);o?selectFeature(o):a&&selectFeature(a)}),map.on("click",e=>{0===map.queryRenderedFeatures(e.point,{layers:["data-points-all"]}).length&&(selectedFeatureId=null,hoverFeatureId=null,updateIconSize())});let hoverDirty=!1;map.on("mousemove","data-points-all",e=>{map.getCanvas().style.cursor="pointer";const t=e.features[0].id;t!==selectedFeatureId&&t!==hoverFeatureId&&(hoverFeatureId=t,hoverDirty||(hoverDirty=!0,requestAnimationFrame(()=>{hoverDirty=!1,updateIconSize()})))}),map.on("mouseleave","data-points-all",()=>{map.getCanvas().style.cursor="",null!==hoverFeatureId&&(hoverFeatureId=null,requestAnimationFrame(updateIconSize))});let hoveredRiverId=null,hoveringLayers=new Set;function updateCursor(){map.getCanvas().style.cursor=hoveringLayers.size>0?"pointer":""}let nextHoverId=null,hoverScheduled=!1;function setRiverHover(e){nextHoverId=e,hoverScheduled||(hoverScheduled=!0,requestAnimationFrame(()=>{hoverScheduled=!1,hoveredRiverId!==nextHoverId&&(null!=hoveredRiverId&&map.setFeatureState({source:"AW Rivers",sourceLayer:"waterways",id:hoveredRiverId},{highlight:!1}),hoveredRiverId=nextHoverId,null!=hoveredRiverId&&map.setFeatureState({source:"AW Rivers",sourceLayer:"waterways",id:hoveredRiverId},{highlight:!0}))}))}map.on("mouseenter","AW Rivers-line",()=>{hoveringLayers.add("line"),updateCursor()}),map.on("mouseleave","AW Rivers-line",()=>{hoveringLayers.delete("line"),updateCursor(),0===hoveringLayers.size&&setRiverHover(null)}),map.on("mousemove","AW Rivers-line",e=>{const t=e.features?.[0];setRiverHover(t?t.id:null)}),map.on("mouseenter","AW Rivers-fill",()=>{hoveringLayers.add("fill"),updateCursor()}),map.on("mouseleave","AW Rivers-fill",()=>{hoveringLayers.delete("fill"),updateCursor(),0===hoveringLayers.size&&setRiverHover(null)}),map.on("mousemove","AW Rivers-fill",e=>{const t=e.features?.[0];setRiverHover(t?t.id:null)});const inputEl=document.getElementById("search"),suggestions=document.getElementById("suggestions");function selectFeatureFromSearch(e){const t=e.geometry.coordinates;clearSelection(),map.flyTo({center:t,zoom:12});const o=void 0!==e.properties.Water;inputEl.value=o?e.properties.Water:e.properties.Title,suggestions.style.display="none",showCard(e),o?(map.setFilter("AW Rivers-line",null),map.setFilter("AW Rivers-fill",null),map.setFeatureState({source:"AW Rivers",sourceLayer:"waterways",id:e.id},{selected:!0}),selectedRiver={id:e.id}):(selectedFeatureId=e.id,hoverFeatureId=null,updateIconSize(),selectedPoint={id:e.id})}inputEl.addEventListener("input",()=>{const e=inputEl.value.trim().toLowerCase();if(suggestions.innerHTML="",!e)return void(suggestions.style.display="none");const t=allFeatures.filter(t=>t.properties.Water.toLowerCase().includes(e)),o=allPointsFeatures.filter(t=>t.properties.Title&&t.properties.Title.toLowerCase().includes(e));if(t.length){const e=document.createElement("div");e.className="suggestion-header river-header",e.innerHTML="<span>WATERWAYS</span>",suggestions.appendChild(e),t.forEach(e=>{const t=document.createElement("div");t.className="suggestion river",t.innerHTML=`\n            <strong>${e.properties.Water}</strong><br>\n            ${"string"==typeof e.properties.Section&&e.properties.Section?`<div class="section">${e.properties.Section}</div>`:""}\n            <div class="region">${e.properties.Region||""}</div>`,t.style.cursor="pointer",t.onclick=()=>selectFeatureFromSearch(e),suggestions.appendChild(t)})}if(o.length){const e=document.createElement("div");e.className="suggestion-header point-header",e.innerHTML="<span> ACCESS POINTS</span>",suggestions.appendChild(e),o.forEach(e=>{const t=document.createElement("div");t.className="suggestion point",t.innerHTML=`\n            <strong>${e.properties.Title}</strong><br>\n            <div class="region">${e.properties.Region||""}</div>`,t.style.cursor="pointer",t.onclick=()=>selectFeatureFromSearch(e),suggestions.appendChild(t)})}suggestions.style.display=t.length||o.length?"block":"none"}),window.setupAWFilters&&window.setupAWFilters(map),window.__TODAY_UNIX__=1786611515</script>